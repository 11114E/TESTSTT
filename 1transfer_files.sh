#!/bin/bash

# Define the username and password
USERNAME="user"
PASSWORD="1"
SOURCE_FILES=(
  "node-2.0.5-linux-amd64.dgst"
  "node-2.0.5-linux-amd64.dgst.sig.1"
  "node-2.0.5-linux-amd64.dgst.sig.2"
  "node-2.0.5-linux-amd64.dgst.sig.4"
  "node-2.0.5-linux-amd64.dgst.sig.5"
  "node-2.0.5-linux-amd64.dgst.sig.7"
  "node-2.0.5-linux-amd64.dgst.sig.9"
  "node-2.0.5-linux-amd64.dgst.sig.13"
  "node-2.0.5-linux-amd64.dgst.sig.14"
  "node-2.0.5-linux-amd64.dgst.sig.16"
  "node-2.0.5-linux-amd64"
)
DEST_DIR="/home/user"

# List of IP addresses
IP_ADDRESSES=(
  172.16.6.16 172.16.6.34 172.16.6.9 172.16.6.7 172.16.6.10
  172.16.6.40 172.16.6.52 172.16.6.96 172.16.6.20 172.16.6.29
  172.16.6.4 172.16.6.61 172.16.6.62 172.16.6.64 172.16.6.63
  172.16.6.66 172.16.6.68 172.16.6.69 172.16.6.67 172.16.6.82
  172.16.6.83 172.16.6.81 172.16.6.84 172.16.6.85 172.16.6.100
  172.16.6.99 172.16.6.98 172.16.6.97 172.16.6.107 172.16.6.125
  172.16.6.126 172.16.6.31 172.16.6.17 172.16.6.15 172.16.6.19
  172.16.6.32 172.16.6.18 172.16.6.118 172.16.6.101 172.16.6.22
  172.16.6.28 172.16.6.8 172.16.6.3 172.16.6.2 172.16.6.44
  172.16.6.43 172.16.6.38 172.16.6.37 172.16.6.46 172.16.6.55
  172.16.6.73 172.16.6.74 172.16.6.60 172.16.6.75 172.16.6.77
  172.16.6.78 172.16.6.79 172.16.6.87 172.16.6.86 172.16.6.88
  172.16.6.102 172.16.6.104 172.16.6.103 172.16.6.117 172.16.6.154
  172.16.6.153 172.16.6.152 172.16.6.147 172.16.6.124 172.16.6.123
  172.16.6.23 172.16.6.41 172.16.6.106 172.16.6.109 172.16.6.148
  172.16.6.149 172.16.6.166 172.16.16.181 172.16.6.12 172.16.6.13
  172.16.6.14 172.16.6.5 172.16.6.39 172.16.6.45 172.16.6.51
  172.16.6.90 172.16.6.94 172.16.6.108 172.16.6.110 172.16.6.111
  172.16.6.115 172.16.6.116 172.16.6.112 172.16.6.113 172.16.6.146
  172.16.6.143 172.16.6.128 172.16.6.120 172.16.6.121 172.16.6.139
  172.16.6.168 172.16.16.182 172.16.16.184 172.16.16.185 172.16.16.186
  172.16.16.188 172.16.6.27 172.16.6.30 172.16.6.42 172.16.6.80
  172.16.6.145 172.16.6.144 172.16.6.163 172.16.6.175 172.16.16.176
  172.16.6.142 172.16.6.127 172.16.6.122 172.16.6.167 172.16.6.136
  172.16.6.131 172.16.6.132 172.16.6.171 172.16.6.170 172.16.6.174
  172.16.6.172 172.16.6.173 172.16.6.183 172.16.6.187 172.16.6.134
  172.16.6.138 172.16.16.177 172.16.16.178 172.16.16.191 172.16.16.190
  172.16.16.189 172.16.6.70 172.16.6.105 172.16.6.49 172.16.6.141
  172.16.6.59 172.16.6.56 172.16.6.179 172.16.6.180 172.16.6.159
  172.16.6.158 172.16.6.151 172.16.6.150 172.16.6.57 172.16.6.162
  172.16.6.58 172.16.6.137 172.16.6.130 172.16.6.133 172.16.6.140
  172.16.6.114 172.16.6.157 172.16.6.156 172.16.6.155 172.16.6.161
  172.16.6.160 172.16.6.135 172.16.6.129 172.16.6.71 172.16.6.95
  172.16.6.91 172.16.6.92 172.16.6.169 172.16.6.35 172.16.6.164
  172.16.6.53
)

# Loop through each IP and transfer the files
for IP in "${IP_ADDRESSES[@]}"; do
  echo "Transferring files to $IP..."
  
  for FILE in "${SOURCE_FILES[@]}"; do
    /usr/bin/expect <<EOF
    log_user 1
    spawn ssh -o StrictHostKeyChecking=no $USERNAME@$IP "[ -f $DEST_DIR/$FILE ] && echo 'File exists'"
    expect {
      "password:" { send "$PASSWORD\r"; exp_continue }
      "yes/no" { send "yes\r"; exp_continue }
    }
    expect eof
EOF

    /usr/bin/expect <<EOF
    log_user 1
    spawn scp -o StrictHostKeyChecking=no /root/ceremonyclient/node/$FILE $USERNAME@$IP:$DEST_DIR
    expect {
      "password:" { send "$PASSWORD\r"; exp_continue }
      "yes/no" { send "yes\r"; exp_continue }
    }
    expect eof
EOF
  done
  
  if [ $? -eq 0 ]; then
    echo "Files transferred to $IP successfully."
  else
    echo "Failed to transfer files to $IP."
  fi
done
